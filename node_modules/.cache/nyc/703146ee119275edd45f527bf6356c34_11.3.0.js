'use strict';var cov_150bx5j7el=function(){var path='/usr/src/services/serverService.js',hash='4261043952e32638024768deb0f2926efb16bc94',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/usr/src/services/serverService.js',statementMap:{'0':{start:{line:2,column:20},end:{line:2,column:45}},'1':{start:{line:3,column:20},end:{line:3,column:60}},'2':{start:{line:4,column:23},end:{line:4,column:66}},'3':{start:{line:5,column:28},end:{line:5,column:76}},'4':{start:{line:7,column:25},end:{line:12,column:20}},'5':{start:{line:14,column:0},end:{line:180,column:1}},'6':{start:{line:15,column:2},end:{line:179,column:3}},'7':{start:{line:17,column:20},end:{line:43,column:8}},'8':{start:{line:18,column:8},end:{line:42,column:12}},'9':{start:{line:28,column:27},end:{line:28,column:29}},'10':{start:{line:29,column:12},end:{line:37,column:14}},'11':{start:{line:30,column:35},end:{line:30,column:37}},'12':{start:{line:31,column:14},end:{line:31,column:47}},'13':{start:{line:32,column:14},end:{line:32,column:43}},'14':{start:{line:33,column:14},end:{line:33,column:47}},'15':{start:{line:34,column:14},end:{line:34,column:59}},'16':{start:{line:35,column:14},end:{line:35,column:62}},'17':{start:{line:36,column:14},end:{line:36,column:43}},'18':{start:{line:38,column:12},end:{line:38,column:29}},'19':{start:{line:41,column:12},end:{line:41,column:21}},'20':{start:{line:44,column:6},end:{line:44,column:20}},'21':{start:{line:47,column:20},end:{line:67,column:8}},'22':{start:{line:48,column:8},end:{line:66,column:9}},'23':{start:{line:49,column:23},end:{line:49,column:63}},'24':{start:{line:50,column:10},end:{line:63,column:11}},'25':{start:{line:51,column:29},end:{line:54,column:13}},'26':{start:{line:55,column:12},end:{line:55,column:48}},'27':{start:{line:56,column:28},end:{line:56,column:66}},'28':{start:{line:57,column:12},end:{line:59,column:14}},'29':{start:{line:60,column:12},end:{line:60,column:30}},'30':{start:{line:62,column:12},end:{line:62,column:65}},'31':{start:{line:65,column:10},end:{line:65,column:48}},'32':{start:{line:68,column:6},end:{line:68,column:20}},'33':{start:{line:71,column:20},end:{line:96,column:8}},'34':{start:{line:72,column:23},end:{line:72,column:38}},'35':{start:{line:73,column:21},end:{line:73,column:63}},'36':{start:{line:74,column:8},end:{line:95,column:9}},'37':{start:{line:75,column:27},end:{line:85,column:11}},'38':{start:{line:86,column:10},end:{line:92,column:14}},'39':{start:{line:88,column:14},end:{line:88,column:27}},'40':{start:{line:91,column:14},end:{line:91,column:52}},'41':{start:{line:94,column:10},end:{line:94,column:63}},'42':{start:{line:97,column:6},end:{line:97,column:20}},'43':{start:{line:100,column:20},end:{line:113,column:8}},'44':{start:{line:101,column:21},end:{line:101,column:78}},'45':{start:{line:102,column:8},end:{line:112,column:9}},'46':{start:{line:103,column:10},end:{line:109,column:12}},'47':{start:{line:106,column:12},end:{line:106,column:36}},'48':{start:{line:108,column:12},end:{line:108,column:50}},'49':{start:{line:111,column:10},end:{line:111,column:88}},'50':{start:{line:114,column:6},end:{line:114,column:20}},'51':{start:{line:117,column:20},end:{line:137,column:8}},'52':{start:{line:118,column:8},end:{line:136,column:12}},'53':{start:{line:124,column:12},end:{line:135,column:13}},'54':{start:{line:125,column:35},end:{line:125,column:37}},'55':{start:{line:126,column:14},end:{line:126,column:47}},'56':{start:{line:127,column:14},end:{line:127,column:43}},'57':{start:{line:128,column:14},end:{line:128,column:47}},'58':{start:{line:129,column:14},end:{line:129,column:59}},'59':{start:{line:130,column:14},end:{line:130,column:59}},'60':{start:{line:131,column:14},end:{line:131,column:69}},'61':{start:{line:132,column:14},end:{line:132,column:37}},'62':{start:{line:134,column:14},end:{line:134,column:92}},'63':{start:{line:138,column:6},end:{line:138,column:20}},'64':{start:{line:141,column:20},end:{line:176,column:8}},'65':{start:{line:142,column:8},end:{line:175,column:10}},'66':{start:{line:143,column:10},end:{line:174,column:11}},'67':{start:{line:144,column:25},end:{line:144,column:52}},'68':{start:{line:145,column:25},end:{line:145,column:65}},'69':{start:{line:146,column:12},end:{line:146,column:49}},'70':{start:{line:147,column:12},end:{line:171,column:13}},'71':{start:{line:148,column:14},end:{line:168,column:15}},'72':{start:{line:150,column:16},end:{line:150,column:44}},'73':{start:{line:151,column:16},end:{line:165,column:20}},'74':{start:{line:154,column:39},end:{line:154,column:41}},'75':{start:{line:155,column:18},end:{line:155,column:51}},'76':{start:{line:156,column:18},end:{line:156,column:47}},'77':{start:{line:157,column:18},end:{line:157,column:51}},'78':{start:{line:158,column:18},end:{line:158,column:63}},'79':{start:{line:159,column:18},end:{line:159,column:63}},'80':{start:{line:160,column:18},end:{line:160,column:73}},'81':{start:{line:161,column:18},end:{line:161,column:41}},'82':{start:{line:164,column:20},end:{line:164,column:65}},'83':{start:{line:167,column:16},end:{line:167,column:68}},'84':{start:{line:170,column:14},end:{line:170,column:67}},'85':{start:{line:173,column:12},end:{line:173,column:90}},'86':{start:{line:177,column:6},end:{line:177,column:20}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:14,column:17},end:{line:14,column:18}},loc:{start:{line:14,column:29},end:{line:180,column:1}},line:14},'1':{name:'(anonymous_1)',decl:{start:{line:16,column:10},end:{line:16,column:11}},loc:{start:{line:16,column:16},end:{line:45,column:5}},line:16},'2':{name:'(anonymous_2)',decl:{start:{line:17,column:32},end:{line:17,column:33}},loc:{start:{line:17,column:53},end:{line:43,column:7}},line:17},'3':{name:'(anonymous_3)',decl:{start:{line:27,column:16},end:{line:27,column:17}},loc:{start:{line:27,column:29},end:{line:39,column:11}},line:27},'4':{name:'(anonymous_4)',decl:{start:{line:29,column:28},end:{line:29,column:29}},loc:{start:{line:29,column:40},end:{line:37,column:13}},line:29},'5':{name:'(anonymous_5)',decl:{start:{line:40,column:17},end:{line:40,column:18}},loc:{start:{line:40,column:24},end:{line:42,column:11}},line:40},'6':{name:'(anonymous_6)',decl:{start:{line:46,column:12},end:{line:46,column:13}},loc:{start:{line:46,column:36},end:{line:69,column:5}},line:46},'7':{name:'(anonymous_7)',decl:{start:{line:47,column:32},end:{line:47,column:33}},loc:{start:{line:47,column:59},end:{line:67,column:7}},line:47},'8':{name:'(anonymous_8)',decl:{start:{line:70,column:12},end:{line:70,column:13}},loc:{start:{line:70,column:30},end:{line:98,column:5}},line:70},'9':{name:'(anonymous_9)',decl:{start:{line:71,column:32},end:{line:71,column:33}},loc:{start:{line:71,column:53},end:{line:96,column:7}},line:71},'10':{name:'(anonymous_10)',decl:{start:{line:87,column:18},end:{line:87,column:19}},loc:{start:{line:87,column:28},end:{line:89,column:13}},line:87},'11':{name:'(anonymous_11)',decl:{start:{line:90,column:19},end:{line:90,column:20}},loc:{start:{line:90,column:26},end:{line:92,column:13}},line:90},'12':{name:'(anonymous_12)',decl:{start:{line:99,column:12},end:{line:99,column:13}},loc:{start:{line:99,column:27},end:{line:115,column:5}},line:99},'13':{name:'(anonymous_13)',decl:{start:{line:100,column:32},end:{line:100,column:33}},loc:{start:{line:100,column:59},end:{line:113,column:7}},line:100},'14':{name:'(anonymous_14)',decl:{start:{line:105,column:18},end:{line:105,column:19}},loc:{start:{line:105,column:24},end:{line:107,column:11}},line:105},'15':{name:'(anonymous_15)',decl:{start:{line:107,column:19},end:{line:107,column:20}},loc:{start:{line:107,column:26},end:{line:109,column:11}},line:107},'16':{name:'(anonymous_16)',decl:{start:{line:116,column:9},end:{line:116,column:10}},loc:{start:{line:116,column:24},end:{line:139,column:5}},line:116},'17':{name:'(anonymous_17)',decl:{start:{line:117,column:32},end:{line:117,column:33}},loc:{start:{line:117,column:53},end:{line:137,column:7}},line:117},'18':{name:'(anonymous_18)',decl:{start:{line:123,column:16},end:{line:123,column:17}},loc:{start:{line:123,column:28},end:{line:136,column:11}},line:123},'19':{name:'(anonymous_19)',decl:{start:{line:140,column:12},end:{line:140,column:13}},loc:{start:{line:140,column:35},end:{line:178,column:5}},line:140},'20':{name:'(anonymous_20)',decl:{start:{line:141,column:32},end:{line:141,column:33}},loc:{start:{line:141,column:53},end:{line:176,column:7}},line:141},'21':{name:'(anonymous_21)',decl:{start:{line:142,column:51},end:{line:142,column:52}},loc:{start:{line:142,column:63},end:{line:175,column:9}},line:142},'22':{name:'(anonymous_22)',decl:{start:{line:153,column:24},end:{line:153,column:25}},loc:{start:{line:153,column:36},end:{line:162,column:17}},line:153},'23':{name:'(anonymous_23)',decl:{start:{line:163,column:25},end:{line:163,column:26}},loc:{start:{line:163,column:32},end:{line:165,column:19}},line:163}},branchMap:{'0':{loc:{start:{line:50,column:10},end:{line:63,column:11}},type:'if',locations:[{start:{line:50,column:10},end:{line:63,column:11}},{start:{line:50,column:10},end:{line:63,column:11}}],line:50},'1':{loc:{start:{line:74,column:8},end:{line:95,column:9}},type:'if',locations:[{start:{line:74,column:8},end:{line:95,column:9}},{start:{line:74,column:8},end:{line:95,column:9}}],line:74},'2':{loc:{start:{line:102,column:8},end:{line:112,column:9}},type:'if',locations:[{start:{line:102,column:8},end:{line:112,column:9}},{start:{line:102,column:8},end:{line:112,column:9}}],line:102},'3':{loc:{start:{line:124,column:12},end:{line:135,column:13}},type:'if',locations:[{start:{line:124,column:12},end:{line:135,column:13}},{start:{line:124,column:12},end:{line:135,column:13}}],line:124},'4':{loc:{start:{line:143,column:10},end:{line:174,column:11}},type:'if',locations:[{start:{line:143,column:10},end:{line:174,column:11}},{start:{line:143,column:10},end:{line:174,column:11}}],line:143},'5':{loc:{start:{line:147,column:12},end:{line:171,column:13}},type:'if',locations:[{start:{line:147,column:12},end:{line:171,column:13}},{start:{line:147,column:12},end:{line:171,column:13}}],line:147},'6':{loc:{start:{line:148,column:14},end:{line:168,column:15}},type:'if',locations:[{start:{line:148,column:14},end:{line:168,column:15}},{start:{line:148,column:14},end:{line:168,column:15}}],line:148}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0,'71':0,'72':0,'73':0,'74':0,'75':0,'76':0,'77':0,'78':0,'79':0,'80':0,'81':0,'82':0,'83':0,'84':0,'85':0,'86':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const errorGetter=(cov_150bx5j7el.s[0]++,require('../util/errors'));const asignarHash=(cov_150bx5j7el.s[1]++,require('../util/functions').asignarHash);const validateParams=(cov_150bx5j7el.s[2]++,require('../util/functions').validateParams);const getFieldsFromParams=(cov_150bx5j7el.s[3]++,require('../util/functions').getFieldsFromParams);const NECESSARY_PARAMS=(cov_150bx5j7el.s[4]++,['id','_rev','created_at','created_by','name','last_connection']);cov_150bx5j7el.s[5]++;module.exports=models=>{cov_150bx5j7el.f[0]++;cov_150bx5j7el.s[6]++;return{list:()=>{cov_150bx5j7el.f[1]++;let promise=(cov_150bx5j7el.s[7]++,new Promise((resolve,reject)=>{cov_150bx5j7el.f[2]++;cov_150bx5j7el.s[8]++;models.Server.findAll({attributes:['id','name','_rev','created_at','last_connection'],order:[['id','ASC']],include:[{model:models.Usuario}]}).then(servers=>{cov_150bx5j7el.f[3]++;let response=(cov_150bx5j7el.s[9]++,[]);cov_150bx5j7el.s[10]++;servers.forEach(server=>{cov_150bx5j7el.f[4]++;let serverResponse=(cov_150bx5j7el.s[11]++,{});cov_150bx5j7el.s[12]++;serverResponse.name=server.name;cov_150bx5j7el.s[13]++;serverResponse.id=server.id;cov_150bx5j7el.s[14]++;serverResponse._rev=server._rev;cov_150bx5j7el.s[15]++;serverResponse.created_at=server.created_at;cov_150bx5j7el.s[16]++;serverResponse.created_by=server.Usuario.email;cov_150bx5j7el.s[17]++;response.push(serverResponse);});cov_150bx5j7el.s[18]++;resolve(response);}).catch(e=>{cov_150bx5j7el.f[5]++;cov_150bx5j7el.s[19]++;reject(e);});}));cov_150bx5j7el.s[20]++;return promise;},create:(usuario_id,params)=>{cov_150bx5j7el.f[6]++;let promise=(cov_150bx5j7el.s[21]++,new Promise(async(resolve,reject)=>{cov_150bx5j7el.f[7]++;cov_150bx5j7el.s[22]++;try{let errors=(cov_150bx5j7el.s[23]++,validateParams(params,NECESSARY_PARAMS));cov_150bx5j7el.s[24]++;if(errors.length===0){cov_150bx5j7el.b[0][0]++;let parameters=(cov_150bx5j7el.s[25]++,{usuario_id:usuario_id,name:params.name});cov_150bx5j7el.s[26]++;parameters=asignarHash(parameters);let newServer=(cov_150bx5j7el.s[27]++,await models.Server.create(parameters));cov_150bx5j7el.s[28]++;await newServer.update({id:newServer.pk});cov_150bx5j7el.s[29]++;resolve(newServer);}else{cov_150bx5j7el.b[0][1]++;cov_150bx5j7el.s[30]++;reject(errorGetter.getServiceErrorLostParams(errors));}}catch(e){cov_150bx5j7el.s[31]++;reject(errorGetter.getServiceError(e));}}));cov_150bx5j7el.s[32]++;return promise;},upload:(file,params)=>{cov_150bx5j7el.f[8]++;let promise=(cov_150bx5j7el.s[33]++,new Promise((resolve,reject)=>{cov_150bx5j7el.f[9]++;let metadata=(cov_150bx5j7el.s[34]++,params.metadata);let errors=(cov_150bx5j7el.s[35]++,validateParams(metadata,NECESSARY_PARAMS));cov_150bx5j7el.s[36]++;if(errors.length===0){cov_150bx5j7el.b[1][0]++;let parameters=(cov_150bx5j7el.s[37]++,{id:metadata.id,filename:metadata.filename,filename_original:file.originalname,resource:metadata.resource,updated_at:metadata.updatedTime,created_at:metadata.createdTime,size:metadata.size,_rev:metadata._rev,visible:true});cov_150bx5j7el.s[38]++;models.FileApplicationUser.create(parameters).then(file=>{cov_150bx5j7el.f[10]++;cov_150bx5j7el.s[39]++;resolve(file);}).catch(e=>{cov_150bx5j7el.f[11]++;cov_150bx5j7el.s[40]++;reject(errorGetter.getServiceError(e));});}else{cov_150bx5j7el.b[1][1]++;cov_150bx5j7el.s[41]++;reject(errorGetter.getServiceErrorLostParams(errors));}}));cov_150bx5j7el.s[42]++;return promise;},delete:server_id=>{cov_150bx5j7el.f[12]++;let promise=(cov_150bx5j7el.s[43]++,new Promise(async(resolve,reject)=>{cov_150bx5j7el.f[13]++;let server=(cov_150bx5j7el.s[44]++,await models.Server.findOne({where:{id:server_id}}));cov_150bx5j7el.s[45]++;if(server){cov_150bx5j7el.b[2][0]++;cov_150bx5j7el.s[46]++;models.Server.destroy({where:{id:server_id}}).then(()=>{cov_150bx5j7el.f[14]++;cov_150bx5j7el.s[47]++;resolve('Baja correcta');}).catch(e=>{cov_150bx5j7el.f[15]++;cov_150bx5j7el.s[48]++;reject(errorGetter.getServiceError(e));});}else{cov_150bx5j7el.b[2][1]++;cov_150bx5j7el.s[49]++;reject(errorGetter.getServiceErrorNotFound(models.Server.getMsgInexistente()));}}));cov_150bx5j7el.s[50]++;return promise;},get:server_id=>{cov_150bx5j7el.f[16]++;let promise=(cov_150bx5j7el.s[51]++,new Promise((resolve,reject)=>{cov_150bx5j7el.f[17]++;cov_150bx5j7el.s[52]++;models.Server.findOne({where:{id:server_id}}).then(server=>{cov_150bx5j7el.f[18]++;cov_150bx5j7el.s[53]++;if(server){cov_150bx5j7el.b[3][0]++;let serverResponse=(cov_150bx5j7el.s[54]++,{});cov_150bx5j7el.s[55]++;serverResponse.name=server.name;cov_150bx5j7el.s[56]++;serverResponse.id=server.id;cov_150bx5j7el.s[57]++;serverResponse._rev=server._rev;cov_150bx5j7el.s[58]++;serverResponse.created_at=server.created_at;cov_150bx5j7el.s[59]++;serverResponse.created_by=server.usuario_id;cov_150bx5j7el.s[60]++;serverResponse.last_connection=server.last_connection;cov_150bx5j7el.s[61]++;resolve(serverResponse);}else{cov_150bx5j7el.b[3][1]++;cov_150bx5j7el.s[62]++;reject(errorGetter.getServiceErrorNotFound(models.Server.getMsgInexistente()));}});}));cov_150bx5j7el.s[63]++;return promise;},update:(server_id,params)=>{cov_150bx5j7el.f[19]++;let promise=(cov_150bx5j7el.s[64]++,new Promise((resolve,reject)=>{cov_150bx5j7el.f[20]++;cov_150bx5j7el.s[65]++;models.Server.findById(server_id,{}).then(server=>{cov_150bx5j7el.f[21]++;cov_150bx5j7el.s[66]++;if(server!==null){cov_150bx5j7el.b[4][0]++;let fields=(cov_150bx5j7el.s[67]++,getFieldsFromParams(params));let errors=(cov_150bx5j7el.s[68]++,validateParams(params,NECESSARY_PARAMS));cov_150bx5j7el.s[69]++;params.usuario_id=params.created_by;cov_150bx5j7el.s[70]++;if(errors.length===0){cov_150bx5j7el.b[5][0]++;cov_150bx5j7el.s[71]++;if(server._rev==params._rev){cov_150bx5j7el.b[6][0]++;cov_150bx5j7el.s[72]++;//Reasgino el hash para poder volver a modificarlo
params=asignarHash(params);cov_150bx5j7el.s[73]++;server.update(params,{fields:fields}).then(server=>{cov_150bx5j7el.f[22]++;let serverResponse=(cov_150bx5j7el.s[74]++,{});cov_150bx5j7el.s[75]++;serverResponse.name=server.name;cov_150bx5j7el.s[76]++;serverResponse.id=server.id;cov_150bx5j7el.s[77]++;serverResponse._rev=server._rev;cov_150bx5j7el.s[78]++;serverResponse.created_at=server.created_at;cov_150bx5j7el.s[79]++;serverResponse.created_by=server.usuario_id;cov_150bx5j7el.s[80]++;serverResponse.last_connection=server.last_connection;cov_150bx5j7el.s[81]++;resolve(serverResponse);}).catch(e=>{cov_150bx5j7el.f[23]++;cov_150bx5j7el.s[82]++;return reject(errorGetter.getServiceError(e));});}else{cov_150bx5j7el.b[6][1]++;cov_150bx5j7el.s[83]++;reject(errorGetter.getServiceErrorAlreadyModified());}}else{cov_150bx5j7el.b[5][1]++;cov_150bx5j7el.s[84]++;reject(errorGetter.getServiceErrorLostParams(errors));}}else{cov_150bx5j7el.b[4][1]++;cov_150bx5j7el.s[85]++;reject(errorGetter.getServiceErrorNotFound(models.Server.getMsgInexistente()));}});}));cov_150bx5j7el.s[86]++;return promise;}};};